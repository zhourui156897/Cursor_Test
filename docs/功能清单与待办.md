# 第二大脑 v0.3 — 功能清单与待办

## 前端访问地址

开发环境下前端地址（以你实际启动方式为准）：

| 启动方式 | 前端地址 |
|----------|----------|
| 在 `frontend` 目录执行 `npm run dev`（默认） | **http://localhost:5173** |
| 使用 `make start`（Makefile 默认端口） | **http://localhost:3000** |

后端 API 文档（Swagger）：**http://localhost:8000/docs**

默认登录（单用户模式）：用户名 `admin`，密码见 `.env` 中 `ADMIN_PASSWORD`（示例里多为 `admin123`）。

---

## 一、已实现功能总览

### 1. 仪表盘 `/`
- 入口页，展示简要统计与导航。

### 2. 数据摄入 `/ingest`
- **文件上传**：支持 Word、PDF、Excel、文本、图片、音频、**视频**（mp4/mov/avi/mkv/webm，需本机安装 ffmpeg，抽音轨后 Whisper 转文字）等；上传后走解析 → 写 Obsidian → 建实体 → LLM 建议标签 → 进审核队列。
- **Apple 三件套同步**：
  - 同步「备忘录 / 待办 / 日历」；支持**数量**（5～200 条）和**排序**（由新到旧 / 由旧到新）。
  - **同步范围（可选）**：展开后可选备忘录文件夹、日历时间范围（过去/未来 N 天）、待办列表与截止日期范围。
- **数据流说明**：可折叠说明「日历/待办如何进入数据库」及 Agent 创建与知识库的关系。
- **新建 Apple 数据**：在页面内创建新备忘录、新待办、新日历事件（需后端在本机 Mac 运行）。

### 3. 审核队列 `/review`
- 列表展示待审核项（LLM 建议的标签）；支持按状态筛选：全部 / 待审核 / 已通过 / 已修改 / 已拒绝。
- 单条操作：**通过**、**拒绝**、**手动配置标签**（选文件夹标签、内容标签后「应用标签」）。
- 批量通过。
- 审核通过后：标签写回实体与 Obsidian frontmatter，笔记按**文件夹标签**移动到对应目录（如 `领域/投资/`）。

### 4. 语义搜索 `/search`
- 自然语言查询，后端做**向量 + 关键词**混合检索（Milvus + SQLite），返回与查询语义相近的实体片段。
- 依赖：实体已向量化（审核通过后会自动尝试写入 Milvus）；若 Milvus 不可用或未嵌入，仍有关键词匹配结果。

### 5. 知识图谱 `/graph`
- 展示实体关系网络（Neo4j）；可查某实体的关联实体与关系类型。
- 依赖 Neo4j 与实体关系抽取（审核通过后触发）。

### 6. 智能对话 `/chat`
- **RAG 问答**：基于检索结果生成回答。
- **Agent 智能体**：可调用工具完成复杂任务，包括：
  - **读取 Apple**：`fetch_apple_data` 实时拉取备忘录/待办/日历；
  - **写入 Apple**：`create_apple_note` / `create_apple_reminder` / `create_apple_event` 在系统 App 中创建，并可选写入知识库实体；
  - **当前时间**：`get_current_datetime` 用于解析「今天」「明天」等；
  - 知识库：`search_knowledge`、`list_entities`、`get_entity_detail`、`summarize_content`、`get_statistics` 等。

### 7. 实体管理 `/entities`
- 列表查看实体，按来源筛选；查看详情、版本与时间线。

### 8. 标签管理 `/tags`
- 树形文件夹标签、内容标签、状态维度的增删改查。

### 9. 用户管理 `/users`
- 多用户模式下的用户列表与角色管理（单用户模式下仍可用）。

### 10. 设置 `/settings`
- **LLM/模型**：API 地址、API Key（脱敏）、模型名、连接测试；
- **Apple 同步**：开关与来源配置；
- **路径配置**：Obsidian Vault、数据目录；
- **系统信息**：各服务状态与数据统计。

### 11. Obsidian 插件（独立安装）
- 在 Obsidian 内：审核队列侧栏、智能对话侧栏、语义搜索弹窗；需配置后端地址与登录信息。

---

## 二、未实现或待优化

### 已实现（原计划中，已落地）
- **定时同步 + 范围持久化**：设置页可配置「是否开启定时同步」与间隔；同步范围在 trigger 成功后写入 `apple_sync.sync_scope`，定时任务按该范围拉取。
- **Agent 按日期过滤**：`fetch_apple_data` 支持 `days_back`/`days_forward`、`due_after`/`due_before`；系统提示引导先 `get_current_datetime` 再传日期。
- **语义搜索错误与空状态**：后端向量失败时返回明确 `message`；前端展示该提示及空状态。
- **同步/创建失败提示**：JXA 统一文案（`messages.py`）；同步 API 与 Agent 工具在 JXA 失败时返回可操作说明（如「请确保后端在本机 Mac 运行」）。
- **知识图谱空状态与不可用提示**：请求失败时前端展示 `stats.error` 或接口错误信息。
- **多模态（视频转文字）**：支持 mp4/mov/avi/mkv/webm，ffmpeg 抽音轨 + Whisper 转文字。
- **完整安装包**：`backend/requirements.txt` 锁定依赖；`docs/在另一台Mac上完整安装.md` 与《使用说明》「七、维护与安装包同步」约定安装与依赖更新。
- **Embedding 维度说明**：《使用说明》已增加「六、Embedding 与 Milvus 维度」；Phase 4.2 为在保存/启动时做维度校验（待做）。

### 未实现 / 计划中
- **智能对话 UI 升级**：希望「炫酷科技感」、侧边栏整合等，目前仍为基础样式。
- **前端标签与 Obsidian 标签双向对齐**：标签在两端一致且可互相驱动，目前主要靠「审核通过后写回 Obsidian」单向同步。

### 待优化
- **语义搜索**：可再做强——无结果时的区分文案、或降级说明更细化。
- **知识图谱**：数据少时图较空；可统一空状态组件样式（与 Phase 3.3 一起）。
- **同步/创建失败提示**：JXA 文案已统一；可考虑在前端「数据摄入」或 Agent 回复中更突出展示。
- **侧边栏与页面整合**：减少层级、合并入口（依赖 Phase 3.1 方案）。
- **Embedding 维度**：已有文档说明；Phase 4.2 为在保存/启动时做校验。

---

## 三、快速对照表

| 功能           | 状态     | 说明 |
|----------------|----------|------|
| 文件上传 → 解析 → 审核 | ✅ 已实现 | 多格式解析，审核通过后写 Obsidian 并可按文件夹移动 |
| Apple 同步（范围可选） | ✅ 已实现 | 文件夹/日历范围/待办列表与截止范围 |
| 审核队列（筛选+手动标签） | ✅ 已实现 | 状态筛选、手动选标签、批量通过 |
| 语义搜索       | ✅ 已实现 | 依赖 Milvus；异常时需更好提示 |
| 知识图谱       | ✅ 已实现 | 依赖 Neo4j 与关系抽取 |
| 智能对话 RAG/Agent | ✅ 已实现 | 含 Apple 读写、当前时间、知识库工具 |
| Agent 创建 → 知识库 | ✅ 已实现 | 可选写入实体，便于检索 |
| 设置（LLM/路径/系统信息） | ✅ 已实现 | 含 API Key、连接测试 |
| Obsidian 插件  | ✅ 已实现 | 审核、对话、搜索 |
| 定时同步 + 范围持久化 | ✅ 已实现 | 设置页配置 + 范围持久化到 sync_scope |
| Agent 按日期过滤读取 | ✅ 已实现 | fetch_apple_data 支持日期参数 |
| 语义搜索错误/空状态 | ✅ 已实现 | 后端 message + 前端展示 |
| 同步/创建失败提示 | ✅ 已实现 | JXA 统一文案，API/Agent 返回可操作说明 |
| 知识图谱空状态/不可用 | ✅ 已实现 | 前端展示错误或空状态提示 |
| 完整安装包（另一台 Mac） | ✅ 已实现 | requirements.txt + 安装文档 + 安装包同步约定 |
| Embedding 维度说明 | ✅ 已实现 | 使用说明中已写；4.2 校验增强待做 |
| 语义搜索/图谱进一步优化 | 🔧 待优化 | 无结果区分文案、空状态样式统一 |
| 智能对话/侧边栏 UI 升级 | 🔧 待优化 | 按你之前期望的样式与整合 |

以上为当前实现与待办总结；前端链接以你实际启动端口为准（**http://localhost:5173** 或 **http://localhost:3000**）。

**在另一台 Mac 上完整安装**：见 `docs/在另一台Mac上完整安装.md`；后端依赖以 `backend/requirements.txt` 为准，前端以 `npm ci` + `package-lock.json` 为准。
